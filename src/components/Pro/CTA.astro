---
/**
 * CTA.astro
 * Pro版: 記事末尾のCall-to-Actionコンポーネント
 *
 * Notionの「CTA管理DB」からリレーションで取得したCTAデータを表示
 */

import type { CTA } from '@/lib/notion/types';

interface Props {
  cta: CTA;
}

const { cta } = Astro.props;

// 背景色のマッピング（NotionのSelectカラーに対応）
const bgColorMap: Record<string, string> = {
  blue: 'bg-blue-600',
  green: 'bg-green-600',
  red: 'bg-red-600',
  yellow: 'bg-yellow-500',
  orange: 'bg-orange-500',
  purple: 'bg-purple-600',
  pink: 'bg-pink-600',
  gray: 'bg-gray-700',
  default: 'bg-gradient-to-r from-blue-600 to-purple-600',
};

const bgColor = cta.backgroundColor
  ? bgColorMap[cta.backgroundColor.toLowerCase()] || bgColorMap.default
  : bgColorMap.default;

// テキスト色（黄色背景の場合は暗い色に）
const textColor = cta.backgroundColor?.toLowerCase() === 'yellow'
  ? 'text-gray-900'
  : 'text-white';
---

<aside class:list={['cta-card rounded-2xl overflow-hidden shadow-lg my-10', bgColor]}>
  <div class="p-6 sm:p-8">
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6">
      <!-- Icon -->
      <div class={`flex-shrink-0 w-12 h-12 ${textColor} opacity-80`}>
        <svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      </div>

      <!-- Content -->
      <div class="flex-1 min-w-0">
        <h3 class={`text-lg sm:text-xl font-bold mb-1 ${textColor}`}>
          {cta.title}
        </h3>
        {cta.description && (
          <p class={`text-sm sm:text-base opacity-90 ${textColor}`}>
            {cta.description}
          </p>
        )}
      </div>

      <!-- Button -->
      <div class="w-full sm:w-auto flex-shrink-0">
        <a
          href={cta.buttonUrl}
          target={cta.buttonUrl.startsWith('http') ? '_blank' : '_self'}
          rel={cta.buttonUrl.startsWith('http') ? 'noopener noreferrer' : undefined}
          class:list={[
            'inline-flex items-center justify-center gap-2 w-full sm:w-auto',
            'px-6 py-3 rounded-xl font-semibold',
            'transition-all duration-200 transform hover:scale-105',
            cta.backgroundColor?.toLowerCase() === 'yellow'
              ? 'bg-gray-900 text-white hover:bg-gray-800'
              : 'bg-white text-gray-900 hover:bg-gray-100',
          ]}
        >
          {cta.buttonText}
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
          </svg>
        </a>
      </div>
    </div>
  </div>
</aside>

<style>
  .cta-card {
    /* グラデーション背景用のアニメーション（オプション） */
    background-size: 200% 200%;
    animation: gradient-shift 8s ease infinite;
  }

  @keyframes gradient-shift {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }
</style>
